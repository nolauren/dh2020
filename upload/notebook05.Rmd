---
title: "Notebook 04"
output: html_document
---

## Getting Started

Before running this notebook, select "Session > Restart R and Clear Output" in
the menu above to start a new R session. This will clear any old data sets and
give us a blank slate to start with.

After starting a new session, run the following code chunk to load the
libraries and data that we will be working with today.

```{r, include=FALSE, message=FALSE}
library(tidyverse)
library(ggrepel)
library(smodels)
library(stringi)

theme_set(theme_minimal())
options(dplyr.summarise.inform = FALSE)
options(width = 77L)

make_scopus_graph_data <- function(input)
{
  cites_sub <- semi_join(cites, input, by = c("id_citing" = "id"))
  cites_sub <- semi_join(cites_sub, input,  by = c("id_cited" = "id"))
  set.seed(1)
  graph <- sm_graph_layout(cites_sub)
  nodes <- inner_join(inner_join(scotus, graph$node, by = "id"), gr_all, by = "id")
  nodes$cluster_all <- as.character(nodes$cluster_all)
  edges <- graph$edge
  return(list(nodes = nodes, edges = edges))
}
```

## Supreme Court Data

The Supreme Court, the highest court in the United States, is the most powerful
part of the judiciary branch. Many stakeholders are interested
in learning about patterns in the Supreme Court. They pose questions such as:

- Are certain kinds of law decided during certain periods of time?
- Are contentious cases more central than others? In other words, are the important cases the ones where judges agree or disagree?
- Which area of the law does the case reflect (according to the WUSTL categories)?
- Which cases are central to case law?
- Which cases are more likely to cited with each other?
- Which cases connect different areas of the law?

.

Let's read in our data.

```{r, message=FALSE}
scotus <- read_csv(file.path("data", "scotus_dh.csv"))
cites <- read_csv(file.path("data", "scotus_cites_dh.csv"))
gr_all <- read_csv(file.path("data", "scotus_gr_all_dh.csv"))
```

Let's take a look at the data.  
- term: Term of the decision.
- chief: The chief justice during the case.
- win_ideology: The ideology of the decision (liberal vs conservative)
- win_party: If favorable, the decision aligns with the win_ideology
- issue_area: The area assigned by Washington University in St. Louis (more info below)

```{r, message=FALSE}
scotus
```

In order to build networks, we need an edge list.  

```{r, message=FALSE}
cites
```



```{r}
counts <- count(cites, id_cited, sort = TRUE)
counts <- left_join(counts, scotus, by = c("id_cited" = "id"))
counts
```

### Selecting Issues


In order to identify areas of that law that cases address,
Washington University in St. Louis assigned each United States Supreme Court
case to a legal issue (ex. desegregation).
The [code book](http://scdb.wustl.edu/documentation.php?s=1) lists the corresponding
issue assigned [each issue number in the data set](https://github.com/introdh2016/response3_network/blob/master/ussc-31.zip).Our data has most of the code but not all.
[Use this list](https://github.com/nolauren/2018introdh/blob/master/lab06_network1_scotus_issue_codes.csv) to decide which cases to analyze.


```{r}
scotus_sub <- filter(scotus, issue %in% c(20130))
gr <- make_scopus_graph_data(scotus_sub)
nodes <- gr$nodes
edges <- gr$edges
```


```{r}
nodes
```

### Plotting Metadata

```{r}
ggplot(nodes) +
  geom_bar(aes(x = minor_votes))
```

```{r}
ggplot(nodes) +
  geom_bar(aes(x = win_party, fill = win_ideology), position = "dodge")
```

```{r}
ggplot(nodes) +
  geom_point(aes(x = term, y = minor_votes, color = chief), size = 2) +
  scale_color_viridis_d()
```

## Network Analysis

```{r}
ggplot(nodes, aes(x, y)) +
  geom_segment(aes(x = x, y = y, xend = xend, yend = yend), alpha = 0.1, data = edges) +
  geom_point(fill = "black", size = 3.5, show.legend = FALSE, pch=21) +
  theme_void()
```

```{r}
ggplot(nodes, aes(x, y)) +
  geom_segment(aes(x = x, y = y, xend = xend, yend = yend), alpha = 0.1, data = edges) +
  geom_point(size = 2, show.legend = FALSE) +
  geom_text_repel(aes(label = id), size = 2) +
  theme_void()
```

```{r}
filter(nodes, id == "2017-020")
```

### Metadata

```{r}
ggplot(nodes, aes(x, y)) +
  geom_segment(aes(x = x, y = y, xend = xend, yend = yend), alpha = 0.1, data = edges) +
  geom_point(aes(fill = chief), size = 3.5, pch=21) +    # you can change the "fill = " to other variables
  theme_void()
```

### Centrality

#### Eigenvalue Centrality

```{r}
ggplot(nodes, aes(x, y)) +
  geom_segment(aes(x = x, y = y, xend = xend, yend = yend), alpha = 0.1, data = edges) +
  geom_point(aes(fill = eigen), size = 3.5, show.legend = FALSE, pch=21) +
  scale_fill_distiller(palette = "Spectral") +
  theme_void()
```

```{r}
arrange(nodes, desc(eigen))
```

```{r}
ggplot(nodes, aes(x, y)) +
  geom_segment(aes(x = x, y = y, xend = xend, yend = yend), alpha = 0.1, data = edges) +
  geom_point(aes(fill = eigen_all), size = 3.5, show.legend = FALSE, pch=21) +
  scale_fill_distiller(palette = "Spectral") +
  theme_void()
```

```{r}
arrange(nodes, desc(eigen_all))
```

#### Betweeness Centrality

```{r}
ggplot(nodes, aes(x, y)) +
  geom_segment(aes(x = x, y = y, xend = xend, yend = yend), alpha = 0.1, data = edges) +
  geom_point(aes(fill = between), size = 3.5, show.legend = FALSE, pch=21) +
  scale_fill_distiller(palette = "Spectral") +
  theme_void()
```

```{r}
arrange(nodes, desc(between))
```


```{r}
ggplot(nodes, aes(x, y)) +
  geom_segment(aes(x = x, y = y, xend = xend, yend = yend), alpha = 0.1, data = edges) +
  geom_point(aes(fill = between_all), size = 3.5, show.legend = FALSE, pch=21) +
  scale_fill_distiller(palette = "Spectral") +
  theme_void()
```

```{r}
arrange(nodes, desc(between_all))
```

### Clusters

```{r}
ggplot(nodes, aes(x, y)) +
  geom_segment(aes(x = x, y = y, xend = xend, yend = yend), alpha = 0.1, data = edges) +
  geom_point(aes(fill = cluster), size = 3.5, pch=21) +
  theme_void()
```

```{r}
split(sprintf("%s (%d)", nodes$case_name, nodes$term), nodes$cluster)
```

```{r}
ggplot(nodes, aes(x, y)) +
  geom_segment(aes(x = x, y = y, xend = xend, yend = yend), alpha = 0.1, data = edges) +
  geom_point(aes(fill = cluster_all), size = 3.5, pch=21) +
  theme_void()
```

```{r}
split(sprintf("%s (%d)", nodes$case_name, nodes$term), nodes$cluster)
```

## Other methods for picking cases

### Important Overall Cases

```{r}
num_cases <- 50
scotus_sub <- left_join(scotus, gr_all, by = "id")
scotus_sub <- arrange(scotus_sub, desc(eigen_all))
scotus_sub <- filter(scotus_sub, component_all == 1)
scotus_sub <- slice_head(scotus_sub, n = num_cases)
gr <- make_scopus_graph_data(scotus_sub)
nodes <- gr$nodes
edges <- gr$edges
```

### Important Within Issue Area

```{r}
num_cases <- 50
scotus_sub <- left_join(scotus, gr_all, by = "id")
scotus_sub <- filter(scotus_sub, issue_area == "Civil Rights")
scotus_sub <- arrange(scotus_sub, desc(eigen_all))
scotus_sub <- filter(scotus_sub, component_all == 1)
scotus_sub <- slice_head(scotus_sub, n = num_cases)
gr <- make_scopus_graph_data(scotus_sub)
nodes <- gr$nodes
edges <- gr$edges
```
